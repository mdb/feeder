name: refresh-ig-access-token

on:
  workflow_dispatch:
  push:
    branches:
      - main
  schedule:
    - cron: 0 0 * * *

jobs:
  refresh-token:
    runs-on: ubuntu-latest
    name: refresh-token
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .nvmrc
      - name: npm-install
        run: npm install
      - name: fetch-ig-media
        env:
          IG_ACCESS_TOKEN: ${{ secrets.IG_ACCESS_TOKEN }}
        run: npm run refresh-ig-token
      - name: update-gh-secret
        uses: hmanzur/actions-set-secret@v2.0.0
        with:
          name: IG_ACCESS_TOKEN
          value: ${{ steps.instagram.outputs.access_token }}
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
